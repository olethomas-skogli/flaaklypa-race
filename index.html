<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta http-equiv="Permissions-Policy" content="unload=()" />
    <title>Il Tempo Gigante Grand Prix</title>
    <link rel="stylesheet" href="gameStyles.css" />
  </head>
  <body>
    <img id="flaklypa-logo" src="image.png" alt="grand prix" />
    <div id="startScreen">
      <div id="startScreenContent">
        <h2 style="color: goldenrod;">Welcome to Il Tempo Gigante Grand Prix! ğŸï¸ğŸ’¨</h2>
        <p>ğŸ’» Use the arrow keys to drive your car.</p>
        <p>ğŸ“± Tap left or right to steer.</p>
        <p>
          Avoid blodstrupmoen, collect Aladdin Oil lamps ğŸ§â€â™‚ï¸ to score points, and
          race as long as you can! 
        </p>
        <p>Sometimes dirty tricks are occuring - catch
          the radar ğŸ“¡ ğŸ‘€ when you can!</p>
      </div>
      <img
        src="il-tempo-gigante.gif"
        alt="grand prix"
        width="600"
        height="200"
        style="margin-bottom: 16px"
      />

      <!-- Step 1: Car Selection -->
      <div id="carSelectionStep">
        <h3>Step 1: Choose Your Car</h3>
        <div id="carOptions">
          <div class="car-option" data-car="il-tempo-gigante">
            <img src="il-tempo-from-above.png" alt="Il Tempo Gigante" />
            <span>Il Tempo Gigante</span>
          </div>
          <div class="car-option" data-car="desperados-rolls-royce">
            <img
              src="desperados-rolls-royce.png"
              alt="Desperados Rolls Royce"
            />
            <span>Desperados Rolls Royce</span>
          </div>
          <div class="car-option" data-car="boomerang-rapido">
            <img src="boomerang-rapido-above.png" alt="Boomerang Rapido" />
            <span>Boomerang Rapido</span>
          </div>
          <div class="car-option" data-car="solan-propell-sykkel">
            <img src="solan-propell-sykkel-v1.png" alt="Solan Propell Sykkel" />
            <span>Solan Propell Sykkel</span>
          </div>
        </div>
        <button id="confirmCarButton" disabled>Confirm Car Selection</button>
      </div>

      <!-- Step 2: Name Input (initially hidden) -->
      <div id="nameInputStep" style="display: none">
        <h3>Step 2: Enter Your Name</h3>
        <input
          type="text"
          id="nameInput"
          placeholder="Enter your name"
          aria-label="Enter your name to start the game"
        />
        <br />
        <button id="confirmNameButton" disabled>Confirm Name</button>
      </div>

      <!-- Step 3: Start Game (initially hidden) -->
      <div id="startGameStep" style="display: none">
        <h3>Ready to Race!</h3>
        <p id="selectedCarDisplay"></p>
        <p id="selectedNameDisplay"></p>
        <button
          id="startButton"
          role="button"
          aria-label="Start the Il Tempo Gigante Grand Prix game"
        >
          Start Game
        </button>
      </div>

      <!-- Leaderboard on Start Menu -->
      <div id="startMenuLeaderboard">
        <img
          id="startLeaderboardImage"
          src="emmanuel.png"
          alt="leaderboard"
          width="80"
          height="auto"
        />
        <h3>Emmanuel's Leaderboard</h3>
        <div
          id="startLeaderboardStatus"
          style="font-size: 12px; margin: 5px 0; color: #888"
        >
          ğŸ”„ Connecting...
        </div>
        <ul id="startLeaderboardList"></ul>
      </div>
    </div>
    <div id="scoreContainer">
      <div id="score">Score: 0</div>
      <img
        id="scoreImage"
        src="aladdin-oil-lamp.png"
        alt="grand prix"
        width="60"
        height="100%"
        style="margin-right: 8px"
      />
      <div id="gameTime">| Time: 0s</div>
      <div id="speedIndicator">Speed: 1.0x</div>
      <div id="fpsCounter">FPS: --</div>
    </div>

    <!-- Game Content Wrapper for Desktop Layout -->
    <div class="game-content-wrapper">
      <canvas id="gameCanvas" width="800" height="800"></canvas>

      <!-- Mobile Game Over Dialog (kept for mobile compatibility) -->
      <div id="mobileGameOverDialog" role="alert">
        <img
          id="mobileGameOverImage"
          src="suppehue.gif"
          alt="Game Over"
          width="400"
          height="100%"
        />
        <div id="mobileGameOverDialogContent">
          <span id="mobileGameOverText"></span>
          <span id="mobileGameOverScore"> </span>
        </div>
      </div>
    </div>

    <!-- Animated Radar for Mist Effect -->
    <div id="radarContainer">
      <img id="radarImage" src="radar.png" alt="Radar" />
    </div>

    <!-- Touch control zones for mobile -->
    <div id="touchZoneLeft" class="touch-zone left"></div>
    <div id="touchZoneRight" class="touch-zone right"></div>

    <!-- F1-Style Countdown Overlay -->
    <div id="countdownOverlay">
      <div id="f1Lights">
        <div class="f1-light" id="light1"></div>
        <div class="f1-light" id="light2"></div>
        <div class="f1-light" id="light3"></div>
      </div>
      <div id="countdownText"></div>
    </div>

    <!-- Game Over Dialog - Desktop positioning -->
    <div id="gameOverDialog" role="alert">
      <div id="gameOverDialogContent">
        <!-- Game over header with image and text in row -->
        <div id="gameOverHeader">
          <img
            id="gameOverImage"
            src="suppehue.gif"
            alt="Game Over"
            width="150"
            height="auto"
          />
          <div id="gameOverTextContainer">
            <span id="gameOverText"></span>
            <span id="gameOverScore"> </span>
          </div>
        </div>

        <!-- Leaderboard moved inside game over dialog -->
        <div id="gameOverLeaderboard">
          <img
            id="leaderboardImage"
            src="emmanuel.png"
            alt="leaderboard"
            width="120"
            height="auto"
          />
          <h2>Emmanuel's Leaderboard</h2>
          <div
            id="leaderboardStatus"
            style="font-size: 12px; margin: 5px 0; color: #888"
          >
            ğŸ”„ Connecting...
          </div>
          <ul id="leaderboardList"></ul>
        </div>

        <button id="restartButton">Restart Game (R)</button>
        <button id="backButton">Back to Menu</button>
      </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="./firebase-config.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script type="module" src="./script.js"></script>
  </body>
</html>
